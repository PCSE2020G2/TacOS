#include <fs.hmm>
#include <util.hmm>
#include "appUtil.hmm"
#include "mp3Files.hmm"

//-----------------------------------------------------------------------------
// MP3ファイルの一覧（ただし，最大５個）
//-----------------------------------------------------------------------------
// ５つのファイル名
char[][] fnames = array(5, 13);                     // 12345678.123
int numFile;                                        // ファイルの個数

char[] mp3Dir = "/MP3";
char[] path = array(18);                            // /MP3/12345678.123

char[][] pathlist;
                                                                                                                        
char[] fnameToPath(char[] fname) {
  strCpy(path, mp3Dir);
  strCat(path, "/");                                                                                                      
  strCat(path, fname);
  return path;
}


// /MP3 ディレクトリからファイルの一覧を作る（初期化）
public void mp3FilesInit() {
      musicIndex[j][i] = 0;

  int fd;                                           // ファイルディスクリプタ
  if ((fd=open(mp3Dir, READ_MODE))<0) {
    panic("panic:can't open MP3 Dir");
  }
  Dir dir;
  int i = 0;
  while (i<5 && (dir=readDir(fd, "MP3"))!=null) {   // 最大5つファイル名を読む
   strCpy(fnames[i], dir.name);
    i = i + 1;
  }
  numFile = i;
  close(fd);
}

// n 番目ファイル名を返す（1<=n && n<=5）
public char[] mp3FilesGetName(int n) {
  if (1<=n && n<=numFile) {
    return fnames[n-1];
  }
  return null;
}

// n 番目パス名を返す（1<=n && n<=5）
public char[] mp3FilesGetPath(int n) {
  if (1<=n && n<=numFile) {
    return fnameToPath(fnames[n-1]);
  }
  return null;
}

//音楽の総数を取得
int getLenMusic(){
  int a = 0;
  Dir dir;
  int fd;
  if ((fd=open(mp3Dir, READ_MODE))<0) {
     panic("panic:can't open MP3 Dir");
  }
 
  while ((dir=readDir(fd, "MP3"))!=null) {   // 最大5つファイル名を読む
    a = a + 1;
  }
  return a;
}

int[][] musicIndex = array(7, getLenMusic());
char[][] pathlist = array(getLenMusic(), 13);

public int getLenList(int m){
  int a = getLenMusic();
  int b = 0;  //プレイリスト内の音楽の総数
  for(int i=0; i<a; i=i+1){
    b = b + musicIndex[m][i];
  }
  return b;
}

public voin mp3FilesInit(){
  int a = getLenMusic();
  for(int i=0; i<a; i++){
    musicIndex[0][i] = 1;
    for(int j=0; j<7; j++){
      musicIndex[j][i] = 0;
  }
}

